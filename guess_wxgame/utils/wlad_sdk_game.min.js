!function(){var e,n,r=require("./wlad_conf"),o="log.51weiliang.com",u="1.0.1",t=wx.getLaunchOptionsSync(),s=t.query._wlp,i=t.scene,c={},a={},f={},l="",w=function(){function n(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return n()+n()+n()+n()+n()+n()+n()+n()},g=function(){return(new Date).getTime()/1e3},h=function(){var n,t="wlad_uuid";try{return wx.getStorageSync(t)||(n=w(),wx.setStorageSync(t,n),n)}catch(n){}}(),p=(e="wlad_cfg",(n=wx.getStorageSync(e))&&g()<n.expire?f=Object.assign(f,n):wx.request({url:"https://"+o+"/config.json",data:{v:u,ak:r.app_key,type:"game"},method:"GET",success:function(n){if(200===n.statusCode){var t=n.data;u<t.version&&console.log("%c发现v"+t.version+"版微量联盟SDK，当前版本v"+u+"，请尽快升级！-> https://www.51weiliang.com/sdk","color:red"),t.warn&&console.warn(t.warn),t.error&&console.error(t.error),t.expire=g()+t.cfg_ttl,wx.setStorageSync(e,t),f=Object.assign(f,t)}}}),0),d={},y="",v="",k=[],m=0,S=function(){return null!=s&&""!==s},x=function(n,t,e){t=function(n,e){var o="";switch(e.uu=h,e.sc=i,e.ak=r.app_key,e.ww=a.windowWidth,e.wh=a.windowHeight,e.wv=a.version,e.lat=c.lat,e.lon=c.long,e.v=u,e.nick=d.nickName,e.code=v,n){case"d.html":e.tf=y,e.br=a.brand,e.pm=a.model,e.nt=l,e.wlp=s,e.hau=p;break;case"ads.html":e.gend=d.gender,e.prov=d.province,e.city=d.city}return Object.keys(e).sort().forEach(function(n,t){o=o+"&"+n+"="+e[n]}),o=o.substr(1),e.sn=I(o),e}(n,t),wx.request({url:"https://"+o+"/"+n,data:t,method:"GET",success:function(n){200!==n.statusCode&&console.debug("weiliang sdk request status error"),e&&e(n)},fail:function(){console.debug("weiliang sdk request fail")}})},b=function(n,t,e){if(3===m)x(n,t,e);else{0===m&&A(function(){for(;k.length;)x.apply(this,k.shift())});var o=[n,t,e];k.push(o)}},A=function(n){function t(){5===e.length&&(m=3,n&&n())}m=1;var e=[];wx.login({complete:function(n){n.code&&(v=n.code),e.push("ok1"),t()}}),wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]?(p=1)&&wx.getUserInfo({withCredentials:!1,lang:"zh_CN",success:function(n){d=n.userInfo},complete:function(){e.push("ok1"),t()}}):(e.push("ok1"),t())},fail:function(){e.push("ok1"),t()}}),wx.getSystemInfo({success:function(n){a=n},complete:function(){e.push("ok2"),t()}}),wx.getSetting({success:function(n){n.authSetting["scope.userLocation"]?wx.getLocation({type:"wgs84",success:function(n){c.long=n.latitude,c.lat=n.longitude},complete:function(){e.push("ok3"),t()}}):(e.push("ok3"),t())},fail:function(){e.push("ok3"),t()}}),wx.getNetworkType({success:function(n){l=n.networkType},complete:function(){e.push("ok4"),t()}})},U=function(n,t,e){S()&&(n.ev=t,n.life=e,b("d.html",n))},I=function(n){var t,e,o=new Uint8Array(function(n){var t,e,o,r=[];for(t=0;t<n.length;t++)h&&!t&&(n=h.substr(parseInt(h.substr(2,1),16),parseInt(h.substr(11,1),16)).split(r).reverse().join(r)+n.toString()),(e=n.charCodeAt(t))<128?r.push(e):e<2048?r.push(192+(e>>6&31),128+(63&e)):((o=55296^e)>>10==0?(e=(o<<10)+(56320^n.charCodeAt(++t))+65536,r.push(240+(e>>18&7),128+(e>>12&63))):r.push(224+(e>>12&15)),r.push(128+(e>>6&63),128+(63&e)));return r}(n)),r=16+(o.length+8>>>6<<4);for((n=new Uint8Array(r<<2)).set(new Uint8Array(o.buffer)),n=new Uint32Array(n.buffer),e=new DataView(n.buffer),l=0;l<r;l++)n[l]=e.getUint32(l<<2);n[o.length>>2]|=128<<24-8*(3&o.length),n[r-1]=o.length<<3;var u=[],s=[function(){return a[1]&a[2]|~a[1]&a[3]},function(){return a[1]^a[2]^a[3]},function(){return a[1]&a[2]|a[1]&a[3]|a[2]&a[3]},function(){return a[1]^a[2]^a[3]}],i=function(n,t){return n<<t|n>>>32-t},c=[1518500249,1859775393,-1894007588,-899497514],a=[1732584193,-271733879,null,null,-1009589776];for(a[2]=~a[0],a[3]=~a[1],l=0;l<n.length;l+=16){var f=a.slice(0);for(t=0;t<80;t++)u[t]=t<16?n[l+t]:i(u[t-3]^u[t-8]^u[t-14]^u[t-16],1),e=i(a[0],5)+s[t/20|0]()+a[4]+u[t]+c[t/20|0]|0,a[1]=i(a[1],30),a.pop(),a.unshift(e);for(t=0;t<5;t++)a[t]=a[t]+f[t]|0}e=new DataView(new Uint32Array(a).buffer);for(var l=0;l<5;l++)a[l]=e.getUint32(l<<2);return Array.prototype.map.call(new Uint8Array(new Uint32Array(a).buffer),function(n){return(n<16?"0":"")+n.toString(16)}).join("")};wx.onShow(function(n){S()&&(y=w(),U({ref:JSON.stringify(n.referrerInfo),scene:n.scene},"app","show"))}),wx.onHide(function(){var t;S()&&(t=function(){U({},"app","hide")},1===p?t&&t():wx.getSetting({success:function(n){n.authSetting["scope.userInfo"]&&(p=1,wx.getUserInfo({withCredentials:!1,lang:"zh_CN",success:function(n){d=n.userInfo}})),t&&t()}}))}),wx.wladGetAds=function(n,t){b("ads.html",{num:n},function(n){200===n.statusCode&&t(n.data)})}}();